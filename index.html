<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n de Negocio - Comida a Domicilio</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-size: 1.1em;
            font-weight: 600;
            color: #495057;
            transition: all 0.3s;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .content {
            padding: 30px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .stat-card h3 {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-card .value {
            font-size: 2em;
            font-weight: bold;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        table thead {
            background: #f8f9fa;
        }

        table th,
        table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        table th {
            font-weight: 600;
            color: #495057;
        }

        table tbody tr:hover {
            background: #f8f9fa;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .delete-btn:hover {
            background: #c82333;
        }

        .positive {
            color: #28a745;
        }

        .negative {
            color: #dc3545;
        }

        .empty-state {
            text-align: center;
            padding: 50px;
            color: #6c757d;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .tabs {
                flex-direction: column;
            }

            table {
                font-size: 0.9em;
            }

            table th,
            table td {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçî Gesti√≥n de Negocio</h1>
            <p>Control de Ventas y Gastos - Comida a Domicilio</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('dashboard')">üìä Dashboard</button>
            <button class="tab" onclick="switchTab('ventas')">üí∞ Ventas</button>
            <button class="tab" onclick="switchTab('gastos')">üí∏ Gastos</button>
            <button class="tab" onclick="switchTab('reportes')">üìà Reportes</button>
        </div>

        <div class="content">
            <!-- DASHBOARD -->
            <div id="dashboard" class="tab-content active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Ventas Totales</h3>
                        <div class="value" id="totalVentas">$0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Gastos Totales</h3>
                        <div class="value" id="totalGastos">$0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Ganancia Neta</h3>
                        <div class="value" id="gananciaNeta">$0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total de Pedidos</h3>
                        <div class="value" id="totalPedidos">0</div>
                    </div>
                </div>

                <h2 style="margin-bottom: 20px;">√öltimas Transacciones</h2>
                <div id="ultimasTransacciones"></div>
            </div>

            <!-- VENTAS -->
            <div id="ventas" class="tab-content">
                <h2 style="margin-bottom: 20px;">Registrar Nueva Venta</h2>
                <div id="alertVenta"></div>
                <form id="formVenta" onsubmit="agregarVenta(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Fecha</label>
                            <input type="date" id="ventaFecha" required>
                        </div>
                        <div class="form-group">
                            <label>Cliente</label>
                            <input type="text" id="ventaCliente" placeholder="Nombre del cliente" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Producto/Platillo</label>
                            <input type="text" id="ventaProducto" placeholder="Descripci√≥n del pedido" required>
                        </div>
                        <div class="form-group">
                            <label>Monto ($)</label>
                            <input type="number" id="ventaMonto" step="0.01" placeholder="0.00" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>M√©todo de Pago</label>
                        <select id="ventaMetodoPago" required>
                            <option value="Efectivo">Efectivo</option>
                            <option value="Tarjeta">Tarjeta</option>
                            <option value="Transferencia">Transferencia</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Notas</label>
                        <textarea id="ventaNotas" rows="3" placeholder="Notas adicionales (opcional)"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Registrar Venta</button>
                </form>

                <h2 style="margin-top: 40px; margin-bottom: 20px;">Historial de Ventas</h2>
                <div id="listaVentas"></div>
            </div>

            <!-- GASTOS -->
            <div id="gastos" class="tab-content">
                <h2 style="margin-bottom: 20px;">Registrar Nuevo Gasto</h2>
                <div id="alertGasto"></div>
                <form id="formGasto" onsubmit="agregarGasto(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Fecha</label>
                            <input type="date" id="gastoFecha" required>
                        </div>
                        <div class="form-group">
                            <label>Categor√≠a</label>
                            <select id="gastoCategoria" required>
                                <option value="Ingredientes">Ingredientes</option>
                                <option value="Empaque">Empaque</option>
                                <option value="Transporte">Transporte</option>
                                <option value="Servicios">Servicios (luz, agua, gas)</option>
                                <option value="Sueldos">Sueldos</option>
                                <option value="Equipo">Equipo y Utensilios</option>
                                <option value="Publicidad">Publicidad</option>
                                <option value="Otro">Otro</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Descripci√≥n</label>
                            <input type="text" id="gastoDescripcion" placeholder="Descripci√≥n del gasto" required>
                        </div>
                        <div class="form-group">
                            <label>Monto ($)</label>
                            <input type="number" id="gastoMonto" step="0.01" placeholder="0.00" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Proveedor/Beneficiario</label>
                        <input type="text" id="gastoProveedor" placeholder="Nombre del proveedor (opcional)">
                    </div>
                    <div class="form-group">
                        <label>Notas</label>
                        <textarea id="gastoNotas" rows="3" placeholder="Notas adicionales (opcional)"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Registrar Gasto</button>
                </form>

                <h2 style="margin-top: 40px; margin-bottom: 20px;">Historial de Gastos</h2>
                <div id="listaGastos"></div>
            </div>

            <!-- REPORTES -->
            <div id="reportes" class="tab-content">
                <h2 style="margin-bottom: 20px;">Reportes y An√°lisis</h2>
                
                <div class="form-group">
                    <label>Filtrar por Per√≠odo</label>
                    <select id="periodoReporte" onchange="generarReporte()">
                        <option value="todo">Todo el tiempo</option>
                        <option value="hoy">Hoy</option>
                        <option value="semana">Esta semana</option>
                        <option value="mes">Este mes</option>
                        <option value="personalizado">Personalizado</option>
                    </select>
                </div>

                <div id="fechasPersonalizadas" style="display: none; margin-bottom: 20px;">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Desde</label>
                            <input type="date" id="fechaDesde" onchange="generarReporte()">
                        </div>
                        <div class="form-group">
                            <label>Hasta</label>
                            <input type="date" id="fechaHasta" onchange="generarReporte()">
                        </div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Ventas del Per√≠odo</h3>
                        <div class="value" id="reporteVentas">$0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Gastos del Per√≠odo</h3>
                        <div class="value" id="reporteGastos">$0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Ganancia Neta</h3>
                        <div class="value" id="reporteGanancia">$0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Margen de Ganancia</h3>
                        <div class="value" id="reporteMargen">0%</div>
                    </div>
                </div>

                <h3 style="margin-top: 30px; margin-bottom: 15px;">Gastos por Categor√≠a</h3>
                <div id="gastosPorCategoria"></div>

                <h3 style="margin-top: 30px; margin-bottom: 15px;">Ventas por M√©todo de Pago</h3>
                <div id="ventasPorMetodo"></div>
            </div>
        </div>
    </div>

    <script>
        // Configuraci√≥n de la API
        const API_URL = window.location.hostname === 'localhost' 
            ? 'http://localhost:3000/api' 
            : '/api';

        // Variables globales
        let ventas = [];
        let gastos = [];

        // Establecer fecha actual en los formularios
        document.getElementById('ventaFecha').valueAsDate = new Date();
        document.getElementById('gastoFecha').valueAsDate = new Date();

        // Funci√≥n para cambiar de pesta√±a
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'dashboard') {
                cargarDatos();
            } else if (tabName === 'ventas') {
                cargarVentas();
            } else if (tabName === 'gastos') {
                cargarGastos();
            } else if (tabName === 'reportes') {
                cargarDatos().then(() => generarReporte());
            }
        }

        // Mostrar alerta
        function mostrarAlerta(elemento, mensaje, tipo) {
            const alertDiv = document.getElementById(elemento);
            alertDiv.innerHTML = `<div class="alert alert-${tipo}">${mensaje}</div>`;
            setTimeout(() => {
                alertDiv.innerHTML = '';
            }, 3000);
        }

        // Cargar datos del servidor
        async function cargarDatos() {
            try {
                const [resVentas, resGastos] = await Promise.all([
                    fetch(`${API_URL}/ventas`),
                    fetch(`${API_URL}/gastos`)
                ]);
                
                ventas = await resVentas.json();
                gastos = await resGastos.json();
                
                actualizarDashboard();
                return true;
            } catch (error) {
                console.error('Error cargando datos:', error);
                return false;
            }
        }

        // Cargar ventas
        async function cargarVentas() {
            try {
                const response = await fetch(`${API_URL}/ventas`);
                ventas = await response.json();
                mostrarVentas();
            } catch (error) {
                console.error('Error cargando ventas:', error);
            }
        }

        // Cargar gastos
        async function cargarGastos() {
            try {
                const response = await fetch(`${API_URL}/gastos`);
                gastos = await response.json();
                mostrarGastos();
            } catch (error) {
                console.error('Error cargando gastos:', error);
            }
        }

        // Agregar venta
        async function agregarVenta(event) {
            event.preventDefault();
            
            const venta = {
                fecha: document.getElementById('ventaFecha').value,
                cliente: document.getElementById('ventaCliente').value,
                producto: document.getElementById('ventaProducto').value,
                monto: parseFloat(document.getElementById('ventaMonto').value),
                metodoPago: document.getElementById('ventaMetodoPago').value,
                notas: document.getElementById('ventaNotas').value
            };
            
            try {
                const response = await fetch(`${API_URL}/ventas`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(venta)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('formVenta').reset();
                    document.getElementById('ventaFecha').valueAsDate = new Date();
                    mostrarAlerta('alertVenta', '‚úì Venta registrada exitosamente', 'success');
                    cargarVentas();
                    cargarDatos();
                } else {
                    mostrarAlerta('alertVenta', '‚úó Error al registrar venta', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                mostrarAlerta('alertVenta', '‚úó Error de conexi√≥n', 'error');
            }
        }

        // Agregar gasto
        async function agregarGasto(event) {
            event.preventDefault();
            
            const gasto = {
                fecha: document.getElementById('gastoFecha').value,
                categoria: document.getElementById('gastoCategoria').value,
                descripcion: document.getElementById('gastoDescripcion').value,
                monto: parseFloat(document.getElementById('gastoMonto').value),
                proveedor: document.getElementById('gastoProveedor').value,
                notas: document.getElementById('gastoNotas').value
            };
            
            try {
                const response = await fetch(`${API_URL}/gastos`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(gasto)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('formGasto').reset();
                    document.getElementById('gastoFecha').valueAsDate = new Date();
                    mostrarAlerta('alertGasto', '‚úì Gasto registrado exitosamente', 'success');
                    cargarGastos();
                    cargarDatos();
                } else {
                    mostrarAlerta('alertGasto', '‚úó Error al registrar gasto', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                mostrarAlerta('alertGasto', '‚úó Error de conexi√≥n', 'error');
            }
        }

        // Eliminar venta
        async function eliminarVenta(id) {
            if (!confirm('¬øEst√°s seguro de eliminar esta venta?')) return;
            
            try {
                const response = await fetch(`${API_URL}/ventas/${id}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    cargarVentas();
                    cargarDatos();
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error al eliminar venta');
            }
        }

        // Eliminar gasto
        async function eliminarGasto(id) {
            if (!confirm('¬øEst√°s seguro de eliminar este gasto?')) return;
            
            try {
                const response = await fetch(`${API_URL}/gastos/${id}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    cargarGastos();
                    cargarDatos();
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error al eliminar gasto');
            }
        }

        // Mostrar ventas
        function mostrarVentas() {
            const lista = document.getElementById('listaVentas');
            
            if (ventas.length === 0) {
                lista.innerHTML = '<div class="empty-state"><p>No hay ventas registradas</p></div>';
                return;
            }
            
            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Cliente</th>
                            <th>Producto</th>
                            <th>M√©todo</th>
                            <th>Monto</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            ventas.sort((a, b) => new Date(b.fecha) - new Date(a.fecha)).forEach(venta => {
                html += `
                    <tr>
                        <td>${formatearFecha(venta.fecha)}</td>
                        <td>${venta.cliente}</td>
                        <td>${venta.producto}</td>
                        <td>${venta.metodoPago}</td>
                        <td class="positive">$${venta.monto.toFixed(2)}</td>
                        <td><button class="delete-btn" onclick="eliminarVenta(${venta.id})">Eliminar</button></td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            lista.innerHTML = html;
        }

        // Mostrar gastos
        function mostrarGastos() {
            const lista = document.getElementById('listaGastos');
            
            if (gastos.length === 0) {
                lista.innerHTML = '<div class="empty-state"><p>No hay gastos registrados</p></div>';
                return;
            }
            
            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Categor√≠a</th>
                            <th>Descripci√≥n</th>
                            <th>Proveedor</th>
                            <th>Monto</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            gastos.sort((a, b) => new Date(b.fecha) - new Date(a.fecha)).forEach(gasto => {
                html += `
                    <tr>
                        <td>${formatearFecha(gasto.fecha)}</td>
                        <td>${gasto.categoria}</td>
                        <td>${gasto.descripcion}</td>
                        <td>${gasto.proveedor || '-'}</td>
                        <td class="negative">$${gasto.monto.toFixed(2)}</td>
                        <td><button class="delete-btn" onclick="eliminarGasto(${gasto.id})">Eliminar</button></td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            lista.innerHTML = html;
        }

        // Actualizar dashboard
        function actualizarDashboard() {
            const totalVentas = ventas.reduce((sum, v) => sum + v.monto, 0);
            const totalGastos = gastos.reduce((sum, g) => sum + g.monto, 0);
            const ganancia = totalVentas - totalGastos;
            
            document.getElementById('totalVentas').textContent = `$${totalVentas.toFixed(2)}`;
            document.getElementById('totalGastos').textContent = `$${totalGastos.toFixed(2)}`;
            document.getElementById('gananciaNeta').textContent = `$${ganancia.toFixed(2)}`;
            document.getElementById('totalPedidos').textContent = ventas.length;
            
            mostrarUltimasTransacciones();
        }

        // Mostrar √∫ltimas transacciones
        function mostrarUltimasTransacciones() {
            const container = document.getElementById('ultimasTransacciones');
            
            const todasTransacciones = [
                ...ventas.map(v => ({...v, tipo: 'venta'})),
                ...gastos.map(g => ({...g, tipo: 'gasto'}))
            ].sort((a, b) => new Date(b.fecha) - new Date(a.fecha)).slice(0, 10);
            
            if (todasTransacciones.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No hay transacciones registradas</p></div>';
                return;
            }
            
            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Tipo</th>
                            <th>Descripci√≥n</th>
                            <th>Monto</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            todasTransacciones.forEach(t => {
                const descripcion = t.tipo === 'venta' ? t.producto : t.descripcion;
                const clase = t.tipo === 'venta' ? 'positive' : 'negative';
                const signo = t.tipo === 'venta' ? '+' : '-';
                
                html += `
                    <tr>
                        <td>${formatearFecha(t.fecha)}</td>
                        <td>${t.tipo === 'venta' ? 'üí∞ Venta' : 'üí∏ Gasto'}</td>
                        <td>${descripcion}</td>
                        <td class="${clase}">${signo}$${t.monto.toFixed(2)}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // Generar reporte
        function generarReporte() {
            const periodo = document.getElementById('periodoReporte').value;
            const fechasDiv = document.getElementById('fechasPersonalizadas');
            
            if (periodo === 'personalizado') {
                fechasDiv.style.display = 'block';
            } else {
                fechasDiv.style.display = 'none';
            }
            
            const fechas = obtenerFechasPeriodo(periodo);
            const ventasFiltradas = ventas.filter(v => {
                const fecha = new Date(v.fecha);
                return fecha >= fechas.inicio && fecha <= fechas.fin;
            });
            
            const gastosFiltrados = gastos.filter(g => {
                const fecha = new Date(g.fecha);
                return fecha >= fechas.inicio && fecha <= fechas.fin;
            });
            
            const totalVentas = ventasFiltradas.reduce((sum, v) => sum + v.monto, 0);
            const totalGastos = gastosFiltrados.reduce((sum, g) => sum + g.monto, 0);
            const ganancia = totalVentas - totalGastos;
            const margen = totalVentas > 0 ? (ganancia / totalVentas * 100) : 0;
            
            document.getElementById('reporteVentas').textContent = `$${totalVentas.toFixed(2)}`;
            document.getElementById('reporteGastos').textContent = `$${totalGastos.toFixed(2)}`;
            document.getElementById('reporteGanancia').textContent = `$${ganancia.toFixed(2)}`;
            document.getElementById('reporteMargen').textContent = `${margen.toFixed(1)}%`;
            
            mostrarGastosPorCategoria(gastosFiltrados);
            mostrarVentasPorMetodo(ventasFiltradas);
        }

        // Obtener fechas seg√∫n per√≠odo
        function obtenerFechasPeriodo(periodo) {
            const hoy = new Date();
            hoy.setHours(23, 59, 59, 999);
            let inicio = new Date();
            
            switch(periodo) {
                case 'hoy':
                    inicio.setHours(0, 0, 0, 0);
                    break;
                case 'semana':
                    inicio.setDate(hoy.getDate() - 7);
                    inicio.setHours(0, 0, 0, 0);
                    break;
                case 'mes':
                    inicio.setDate(hoy.getDate() - 30);
                    inicio.setHours(0, 0, 0, 0);
                    break;
                case 'personalizado':
                    const desde = document.getElementById('fechaDesde').value;
                    const hasta = document.getElementById('fechaHasta').value;
                    if (desde && hasta) {
                        inicio = new Date(desde);
                        return { inicio, fin: new Date(hasta) };
                    }
                    break;
                default:
                    inicio = new Date(0);
            }
            
            return { inicio, fin: hoy };
        }

        // Mostrar gastos por categor√≠a
        function mostrarGastosPorCategoria(gastosFiltrados) {
            const container = document.getElementById('gastosPorCategoria');
            
            if (gastosFiltrados.length === 0) {
                container.innerHTML = '<p style="color: #6c757d;">No hay datos para mostrar</p>';
                return;
            }
            
            const porCategoria = {};
            gastosFiltrados.forEach(g => {
                porCategoria[g.categoria] = (porCategoria[g.categoria] || 0) + g.monto;
            });
            
            let html = '<table><thead><tr><th>Categor√≠a</th><th>Total</th></tr></thead><tbody>';
            
            Object.entries(porCategoria)
                .sort((a, b) => b[1] - a[1])
                .forEach(([categoria, total]) => {
                    html += `<tr><td>${categoria}</td><td class="negative">$${total.toFixed(2)}</td></tr>`;
                });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // Mostrar ventas por m√©todo
        function mostrarVentasPorMetodo(ventasFiltradas) {
            const container = document.getElementById('ventasPorMetodo');
            
            if (ventasFiltradas.length === 0) {
                container.innerHTML = '<p style="color: #6c757d;">No hay datos para mostrar</p>';
                return;
            }
            
            const porMetodo = {};
            ventasFiltradas.forEach(v => {
                porMetodo[v.metodoPago] = (porMetodo[v.metodoPago] || 0) + v.monto;
            });
            
            let html = '<table><thead><tr><th>M√©todo de Pago</th><th>Total</th></tr></thead><tbody>';
            
            Object.entries(porMetodo)
                .sort((a, b) => b[1] - a[1])
                .forEach(([metodo, total]) => {
                    html += `<tr><td>${metodo}</td><td class="positive">$${total.toFixed(2)}</td></tr>`;
                });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // Formatear fecha
        function formatearFecha(fecha) {
            const f = new Date(fecha + 'T00:00:00');
            return f.toLocaleDateString('es-MX', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
        }

        // Inicializar
        cargarDatos();
    </script>
</body>
</html>
